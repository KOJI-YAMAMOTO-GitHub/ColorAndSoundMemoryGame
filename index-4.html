<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>サイモンゲーム</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #2c3e50;
            font-family: 'Arial', sans-serif;
            color: white;
        }

        #status {
            font-size: 2rem;
            margin-bottom: 20px;
            height: 1.2em;
        }

        .game-container {
            display: grid;
            grid-template-columns: 150px 150px;
            gap: 20px;
            background: #34495e;
            padding: 20px;
            border-radius: 50%;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        .pad {
            width: 150px;
            height: 150px;
            border-radius: 20px;
            cursor: pointer;
            opacity: 0.6;
            transition: 0.1s;
        }

        .pad:active { transform: scale(0.95); }

        /* 各色の設定 */
        #green  { background-color: #2ecc71; border-top-left-radius: 100%; }
        #red    { background-color: #e74c3c; border-top-right-radius: 100%; }
        #yellow { background-color: #f1c40f; border-bottom-left-radius: 100%; }
        #blue   { background-color: #3498db; border-bottom-right-radius: 100%; }

        /* 点灯時のスタイル */
        .active { opacity: 1 !important; box-shadow: 0 0 30px white; }

        button {
            margin-top: 30px;
            padding: 10px 30px;
            font-size: 1.2rem;
            cursor: pointer;
            background: #ecf0f1;
            border: none;
            border-radius: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="status">Press Start!</div>

    <div class="game-container">
        <div class="pad" id="green" onclick="userClick('green')"></div>
        <div class="pad" id="red" onclick="userClick('red')"></div>
        <div class="pad" id="yellow" onclick="userClick('yellow')"></div>
        <div class="pad" id="blue" onclick="userClick('blue')"></div>
    </div>

    <button id="start-btn" onclick="startGame()">START</button>

    <script>
        let gameSequence = [];
        let userSequence = [];
        let level = 0;
        let isPlaying = false;
        const colors = ['green', 'red', 'yellow', 'blue'];

        // 音の代わり（AudioContextを使用）
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(freq) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            osc.start();
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.5);
            osc.stop(audioCtx.currentTime + 0.5);
        }

        const tones = { green: 261.63, red: 329.63, yellow: 392.00, blue: 523.25 };

        function startGame() {
            gameSequence = [];
            level = 0;
            isPlaying = true;
            document.getElementById('start-btn').style.display = 'none';
            nextRound();
        }

        function nextRound() {
            userSequence = [];
            level++;
            document.getElementById('status').innerText = `Level ${level}`;
            
            const nextColor = colors[Math.floor(Math.random() * 4)];
            gameSequence.push(nextColor);
            
            playSequence();
        }

        async function playSequence() {
            isPlaying = false; // 再生中はクリック不可
            for (const color of gameSequence) {
                await new Promise(resolve => setTimeout(resolve, 600));
                activatePad(color);
            }
            isPlaying = true;
        }

        function activatePad(color) {
            const pad = document.getElementById(color);
            pad.classList.add('active');
            playTone(tones[color]);
            setTimeout(() => pad.classList.remove('active'), 300);
        }

        function userClick(color) {
            if (!isPlaying) return;

            activatePad(color);
            userSequence.push(color);

            const currentIndex = userSequence.length - 1;

            if (userSequence[currentIndex] !== gameSequence[currentIndex]) {
                gameOver();
                return;
            }

            if (userSequence.length === gameSequence.length) {
                isPlaying = false;
                setTimeout(nextRound, 1000);
            }
        }

        function gameOver() {
            document.getElementById('status').innerText = `Game Over! Score: ${level - 1}`;
            document.getElementById('start-btn').style.display = 'block';
            document.getElementById('start-btn').innerText = 'RETRY';
            isPlaying = false;
        }
    </script>
</body>
</html>